<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>我的导航</title>
    <style>
        :root { --ios-bg: #F2F2F7; --ios-card: rgba(255, 255, 255, 0.8); --ios-text: #1C1C1E; --ios-blue: #007AFF; }
        body { background: var(--ios-bg); font-family: -apple-system, sans-serif; padding: 40px 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .category-section { margin-bottom: 30px; }
        .category-title { font-size: 20px; font-weight: 700; margin-bottom: 15px; display: flex; align-items: center; }
        .category-title::before { content: ""; width: 4px; height: 18px; background: var(--ios-blue); margin-right: 10px; border-radius: 2px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 16px; }
        .card { background: var(--ios-card); backdrop-filter: blur(20px); border-radius: 22px; padding: 18px; text-decoration: none; color: inherit; border: 1px solid rgba(255, 255, 255, 0.4); box-shadow: 0 4px 15px rgba(0,0,0,0.03); transition: 0.2s; }
        .card:active { transform: scale(0.92); }
        .icon { width: 48px; height: 48px; border-radius: 12px; margin-bottom: 12px; background: #fff; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .icon img { width: 28px; height: 28px; object-fit: contain; }
        .card-title { font-size: 15px; font-weight: 600; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .card-desc { font-size: 12px; color: #8E8E93; height: 32px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
        #loader { text-align: center; margin-top: 50px; color: #8E8E93; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="font-size: 34px; margin-bottom: 30px;">收藏</h1>
        <div id="main"><div id="loader">正在同步 GitHub 节点...</div></div>
    </div>

    <script>
        const GITHUB_CONFIG = { user: 'edc8', repo: 'hex' };

        async function init() {
            // 尝试多个 API 节点：1. 官方 API  2. GitMirror 镜像
            const nodes = [
                `https://api.github.com/repos/${GITHUB_CONFIG.user}/${GITHUB_CONFIG.repo}/issues?state=open`,
                `https://api.gitmirror.com/repos/${GITHUB_CONFIG.user}/${GITHUB_CONFIG.repo}/issues?state=open`
            ];

            let issues = null;
            let errorMsg = "";

            for (let url of nodes) {
                try {
                    const res = await fetch(url);
                    if (res.ok) {
                        issues = await res.json();
                        break; // 成功获取则跳出循环
                    }
                } catch (e) {
                    errorMsg = e.message;
                }
            }

            if (!issues) {
                document.getElementById('loader').innerHTML = `加载失败<br><small style="color:red">错误原因: ${errorMsg || '网络连接超时'}</small><br><br>请确保仓库已设为 Public`;
                return;
            }

            const groups = {};
            issues.forEach(issue => {
                // 健壮性修复：防止没有 Label 或 Body 时报错
                const category = (issue.labels && issue.labels.length > 0) ? issue.labels[0].name : '未分类';
                if (!groups[category]) groups[category] = [];
                
                const lines = issue.body ? issue.body.split('\n') : [];
                const url = lines[0]?.trim() || '#';
                const desc = lines.slice(1).join(' ').trim() || '快捷链接';
                
                let domain = '';
                try { if(url.startsWith('http')) domain = new URL(url).hostname; } catch(e) {}

                groups[category].push({
                    title: issue.title,
                    url: url,
                    desc: desc,
                    icon: domain ? `https://favicon.splitbee.io/?url=${domain}` : 'https://github.githubassets.com/favicons/favicon.svg'
                });
            });
            render(groups);
        }

        function render(groups) {
            const main = document.getElementById('main');
            main.innerHTML = '';
            if (Object.keys(groups).length === 0) {
                main.innerHTML = '<div id="loader">仓库中没有找到 Open 的 Issues。</div>';
                return;
            }
            for (const cat in groups) {
                const section = document.createElement('div');
                section.className = 'category-section';
                section.innerHTML = `<div class="category-title">${cat}</div><div class="grid">${groups[cat].map(item => `
                    <a href="${item.url}" class="card" target="_blank">
                        <div class="icon"><img src="${item.icon}" onerror="this.src='https://github.githubassets.com/favicons/favicon.svg'"></div>
                        <div class="card-title">${item.title}</div>
                        <div class="card-desc">${item.desc}</div>
                    </a>`).join('')}</div>`;
                main.appendChild(section);
            }
        }
        init();
    </script>
</body>
</html>
